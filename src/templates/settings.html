<!doctype html>
<html lang="it">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="styles/main.css" />
        <link rel="icon" href="images/favicon.ico" type="image/x-icon" />
        <title>Impostazioni | ESU Advisor</title>
        <script src="scripts/theme.js"></script>
    </head>
    <body>
        <template id="header-template"></template>

        <main class="form-container">
            <div class="card card-expanded">
                <div class="form-header">
                    <h1 class="text-primary">Impostazioni</h1>
                </div>

                <template id="server-response-template"></template>

                <div class="card-body">
                    <!-- Sezione Preferenze generali (visibile a tutti) -->
                    <section class="mb-4 pb-4 border-b">
                        <h2 class="text-lg font-semibold mb-3">Preferenze</h2>
                        <form action="settings.php" id="preferenze-generali" method="post" class="base-form">
                            <div class="form-group">
                                <label for="mensa-preferita-select">Seleziona la tua mensa preferita:</label>
                                <select class="form-select" id="mensa-preferita-select" name="mensa_preferita">
                                    <template id="mense-options-template"></template>
                                </select>
                                <p class="text-secondary mt-2 text-sm">
                                    La mensa selezionata verrà visualizzata automaticamente all'apertura del menu.
                                </p>
                            </div>
                            
                            <!-- Implementazione allergeni migliorata -->
                            <div class="form-group">
                                <fieldset>
                                    <legend>Allergeni da segnalare:</legend>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="allergene-glutine" name="allergeni[]" value="glutine">
                                            <label for="allergene-glutine">Glutine</label>
                                        </div>
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="allergene-lattosio" name="allergeni[]" value="lattosio">
                                            <label for="allergene-lattosio">Lattosio</label>
                                        </div>
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="allergene-frutta_a_guscio" name="allergeni[]" value="frutta_a_guscio">
                                            <label for="allergene-frutta_a_guscio">Frutta a guscio</label>
                                        </div>
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="allergene-crostacei" name="allergeni[]" value="crostacei">
                                            <label for="allergene-crostacei">Crostacei</label>
                                        </div>
                                    </div>
                                    <p class="text-secondary mt-2 text-sm">
                                        I piatti contenenti questi allergeni verranno segnalati durante la navigazione.
                                    </p>
                                </fieldset>
                            </div>

                            <button type="submit" name="save_preferenze_generali" class="form-button">Salva preferenze</button>
                        </form>
                    </section>

                    <!-- Sezione Accessibilità (visibile a tutti) -->
                    <section class="mb-4 pb-4 border-b">
                        <h2 class="text-lg font-semibold mb-3">Accessibilità</h2>
                        <form action="settings.php" id="preferenze-accessibilità" method="post" class="base-form">
                            <div class="form-group">
                                <label for="modifica-tema-select">Modifica tema:</label>
                                <select class="form-select" id="modifica-tema-select" name="modifica_tema">
                                    <template id="tema-option-template"></template>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="dimensioni-testo-select">Dimensioni testo:</label>
                                <select class="form-select" id="dimensioni-testo-select" name="dimensione_testo">
                                    <template id="dimensione-testo-options-template"></template>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="dimensioni-icone-select">Dimensioni icone:</label>
                                <select class="form-select" id="dimensioni-icone-select" name="dimensione_icone">
                                    <template id="dimensione-icone-options-template"></template>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="modifica-font-select">Modifica font:</label>
                                <select class="form-select" id="modifica-font-select" name="modifica_font">
                                    <template id="font-options-template"></template>
                                </select>
                            </div>
                            <button type="submit" name="preferences" class="form-button">Salva</button>
                        </form>
                    </section>

                    <!-- Sezione Account (visibile solo agli utenti loggati) -->
                    <template id="account-settings-template"></template>
                </div>
            </div>

            <button type="button" id="back-to-top" class="back-to-top" aria-label="Torna all'inizio della pagina">
                Torna su <span aria-hidden="true">&uarr;</span>
            </button>
        </main>

        <template id="footer-template"></template>

        <script src="scripts/user-settings.js"></script>
        <script src="scripts/theme-switcher.js"></script>
        <script src="scripts/change_password_validation.js"></script>
        <script src="scripts/change_username_validation.js"></script>
        <script src="scripts/back-to-top.js"></script>
    </body>
</html>